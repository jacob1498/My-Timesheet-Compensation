<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="My-DTR">
    <meta name="theme-color" content="#007bff">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3135/3135715.png">
    <title>My-DTR</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { 
            --primary-color: #007bff; 
            --bg-color: #f9f9f9;
            --card-bg: #ffffff;
            --text-color: #333;
            --text-muted: #666;
            --border-color: #eee;
            --th-bg: #f8f9fa;
            --input-bg: #f0f2f5;
        }
        body.dark-mode {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --text-muted: #aaa;
            --border-color: #333;
            --th-bg: #2d2d2d;
            --input-bg: #2a2a2a;
        }

        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 1000px; margin: 2rem auto; padding: 0 1rem; background-color: var(--bg-color); color: var(--text-color); transition: background 0.3s, color 0.3s; }
        h1, h2 { text-align: center; color: var(--text-color); }
        
        .container { background: var(--card-bg); padding: 2rem; border-radius: 16px; box-shadow: 0 4px 6px rgba(0,0,0,0.02); border: 1px solid var(--border-color); transition: background 0.3s; }
        
        /* Layout for Sidebar */
        .app-layout { display: flex; gap: 1.5rem; align-items: flex-start; }
        .sidebar { width: 80px; background: var(--card-bg); padding: 1.5rem 0.5rem; border-radius: 16px; display: flex; flex-direction: column; gap: 0.8rem; border: 1px solid var(--border-color); align-items: center; transition: width 0.3s; }
        .main-content { flex: 1; background: var(--card-bg); padding: 2rem; border-radius: 16px; border: 1px solid var(--border-color); min-height: 500px; }
        
        .nav-btn { text-align: center; background: transparent; color: var(--text-muted); padding: 0.8rem; border-radius: 12px; font-weight: 500; transition: all 0.2s; width: 100%; display: flex; justify-content: center; align-items: center; }
        .nav-btn:hover { background-color: var(--bg-color); color: var(--primary-color); filter: none; transform: scale(1.05); }
        .nav-btn.active { background-color: var(--primary-color); color: white; box-shadow: 0 4px 12px rgba(0,123,255,0.2); }
        .nav-btn i { font-size: 1.3rem; margin: 0; }
        .nav-btn span { display: none; } /* Hide text on desktop */

        .section { display: none; }
        .section.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .form-group { display: flex; gap: 1rem; align-items: flex-end; flex-wrap: wrap; margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border-color); }
        .input-wrapper { display: flex; flex-direction: column; }
        
        label { font-size: 0.9rem; margin-bottom: 0.3rem; color: var(--text-muted); }
        input, select { padding: 0.8rem; border: 1px solid transparent; background-color: var(--input-bg); border-radius: 8px; font-size: 0.95rem; color: var(--text-color); transition: all 0.2s; width: 100%; box-sizing: border-box; }
        input:focus, select:focus { outline: none; border-color: var(--primary-color); background-color: var(--card-bg); box-shadow: 0 0 0 4px rgba(0, 123, 255, 0.1); }
        
        button { padding: 0.8rem 1.5rem; cursor: pointer; background-color: var(--primary-color); color: white; border: none; border-radius: 8px; font-size: 0.95rem; font-weight: 500; transition: transform 0.1s, filter 0.2s; }
        button:hover { filter: brightness(85%); }
        button:active { transform: scale(0.98); }
        button i { margin-right: 0.5rem; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        th, td { border-bottom: 1px solid var(--border-color); padding: 12px; text-align: left; color: var(--text-color); }
        th { background-color: var(--th-bg); font-weight: 600; color: var(--text-color); }
        
        .delete-btn { background-color: #dc3545; padding: 0.4rem 0.8rem; font-size: 0.9rem; }
        .delete-btn:hover { background-color: #a71d2a; }
        
        .total-row { font-weight: bold; background-color: var(--border-color); }

        .avatar { width: 100px; height: 100px; border-radius: 50%; margin: 0 auto 1rem; display: block; border: 3px solid var(--primary-color); padding: 3px; background: #fff; cursor: pointer; object-fit: cover; }
        
        /* Top Bar & Search */
        .top-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border-color); }
        .greeting { font-weight: 600; font-size: 1.1rem; margin-right: 1rem; color: var(--primary-color); }
        .search-container { position: relative; width: 350px; }
        .search-container i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--text-muted); }
        .search-container input { width: 100%; padding-left: 40px; border-radius: 20px; }
        .mini-avatar { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; cursor: pointer; border: 2px solid var(--primary-color); }
        
        /* Toggle Switch */
        .switch-wrapper { display: flex; align-items: center; gap: 10px; margin-top: 1rem; }
        .switch { position: relative; display: inline-block; width: 50px; height: 24px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary-color); }
        input:checked + .slider:before { transform: translateX(26px); }

        .link-btn { background: none; border: none; color: var(--text-muted); cursor: pointer; text-decoration: underline; font-size: 0.85rem; margin-top: 1rem; padding: 0; }
        .link-btn:hover { color: var(--primary-color); }
        
        /* Auth Screens Design */
        .auth-container { max-width: 400px; width: 90%; margin: 4rem auto; text-align: center; padding: 2.5rem; border-radius: 24px; box-shadow: 0 20px 40px rgba(0,0,0,0.08); }
        .auth-input-group { margin-bottom: 1.2rem; }
        .auth-input-group input { text-align: center; margin-bottom: 0.8rem; }
        .remember-me { display: flex; align-items: center; justify-content: center; gap: 0.5rem; margin-bottom: 1.2rem; color: var(--text-muted); font-size: 0.9rem; cursor: pointer; }
        .remember-me input { width: auto; margin: 0; cursor: pointer; }
        
        /* Mobile Responsive Styles */
        @media (max-width: 600px) {
            body { margin: 1rem auto; padding: 0 0.5rem; }
            .app-layout { flex-direction: column; }
            .sidebar { width: 100%; flex-direction: row; justify-content: space-around; padding: 0.5rem; box-sizing: border-box; overflow-x: visible; }
            .nav-btn { width: auto; flex-direction: column; gap: 4px; padding: 0.5rem; font-size: 0.8rem; }
            .nav-btn i { font-size: 1.2rem; }
            .nav-btn span { display: block; font-size: 0.7rem; } /* Show text on mobile */
            .main-content { width: 100%; padding: 1rem; box-sizing: border-box; }
            
            .search-container { width: 140px; }
            .greeting { display: none; } /* Hide greeting on mobile to save space */
            
            .form-group { flex-direction: column; gap: 0.8rem; align-items: stretch; }
            .input-wrapper { width: 100%; }
            button#addBtn { width: 100%; margin-top: 0.5rem; }

            /* Responsive Table (Card View) */
            thead { display: none; }
            tr { display: block; border: 1px solid var(--border-color); margin-bottom: 1rem; border-radius: 4px; background: var(--card-bg); box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
            td { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); text-align: right; padding: 10px; }
            td:last-child { border-bottom: none; }
            td::before { content: attr(data-label); font-weight: 600; color: var(--text-muted); margin-right: 1rem; }
        }
    </style>
</head>
<body>
    <!-- Register Screen -->
    <div class="container auth-container" id="registerContainer" style="display: none;">
        <h2>Create Account</h2>
        <div class="auth-input-group">
            <input type="text" id="regUsername" placeholder="Enter Username">
            <input type="password" id="regPassword" placeholder="Create Password">
            <input type="password" id="regConfirmPassword" placeholder="Confirm Password">
        </div>
        <button id="registerBtn" style="width: 100%;">Register</button>
        <button id="backToLoginBtn" class="link-btn" style="display: none;">Back to Login</button>
    </div>

    <!-- Login Screen -->
    <div class="container auth-container" id="loginContainer" style="display: none;">
        <input type="file" id="avatarUpload" accept="image/*" style="display: none;">
        <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="User Avatar" class="avatar" id="userAvatar" title="Click to upload image">
        <h2 id="loginTitle">Welcome Back</h2>
        <div class="auth-input-group">
            <input type="text" id="loginUsername" placeholder="Username">
            <input type="password" id="passcode" placeholder="Enter Passcode">
        </div>
        <label class="remember-me">
            <input type="checkbox" id="rememberMe"> Remember Me
        </label>
        <button id="loginBtn" style="width: 100%;"><i class="fas fa-key"></i> Access System</button>
        <button id="bioBtn" style="width: 100%; margin-top: 0.5rem; background-color: #28a745;"><i class="fas fa-fingerprint"></i> Login with Fingerprint</button>
        <button id="goToRegisterBtn" class="link-btn">Create New Account</button>
        <button id="forgotBtn" class="link-btn">Forgot Password? (Reset)</button>
        <p id="loginError" style="color: #dc3545; display: none; margin-top: 10px;">Incorrect Username or Password</p>
    </div>

    <!-- Main App Layout -->
    <div class="app-layout" id="mainContainer" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar">
            <h3 style="text-align: center; margin: 0.5rem 0 1rem; color: var(--primary-color); font-size: 0.8rem;">DTR</h3>
            <button class="nav-btn active" onclick="showSection('home')" title="Home"><i class="fas fa-home"></i> <span>Home</span></button>
            <button class="nav-btn" onclick="showSection('profile')" title="Profile"><i class="fas fa-user"></i> <span>Profile</span></button>
            <button class="nav-btn" onclick="showSection('settings')" title="Settings"><i class="fas fa-cog"></i> <span>Settings</span></button>
            <div style="flex-grow: 1;"></div>
            <button id="logoutBtn" class="nav-btn" style="color: #dc3545;" title="Logout"><i class="fas fa-sign-out-alt"></i> <span>Logout</span></button>
        </div>
        
        <!-- Content Area -->
        <div class="main-content">
            <div class="top-header">
                <span class="greeting" id="topGreeting">Hello, User</span>
                <div class="search-container">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Search records...">
                </div>
                <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" class="mini-avatar" id="topAvatar" title="Go to Profile">
            </div>
            
            <!-- Home Section -->
            <div id="homeSection" class="section active">
                <div class="form-group">
                    <div class="input-wrapper">
                        <label for="date">Date</label>
                        <input type="date" id="date">
                    </div>
                    <div class="input-wrapper">
                        <label for="timeIn">Time In</label>
                        <input type="time" id="timeIn">
                    </div>
                    <div class="input-wrapper">
                        <label for="timeOut">Time Out</label>
                        <input type="time" id="timeOut">
                    </div>
                    <button id="addBtn"><i class="fas fa-plus-circle"></i> Add Entry</button>
                </div>

                <table id="dtrTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Time In</th>
                            <th>Time Out</th>
                            <th>Hours</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Rows will be added here via JS -->
                    </tbody>
                </table>
            </div>

            <!-- Profile Section -->
            <div id="profileSection" class="section">
                <h2>My Profile</h2>
                <div style="text-align: center; margin-top: 2rem;">
                    <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="Profile Avatar" class="avatar" id="profileAvatar" title="Click to change">
                    <p style="color: var(--text-muted);">Click image to update avatar</p>
                </div>
            </div>

            <!-- Settings Section -->
            <div id="settingsSection" class="section">
                <h2>Settings</h2>
                <div style="max-width: 400px; margin: 0 auto;">
                    <div class="form-group" style="flex-direction: column; align-items: flex-start; gap: 0.5rem;">
                        <label>Theme Color</label>
                        <input type="color" id="themePicker" value="#007bff" style="width: 100%; height: 40px; cursor: pointer;">
                    </div>
                    
                    <div class="switch-wrapper">
                        <label class="switch">
                            <input type="checkbox" id="darkModeToggle">
                            <span class="slider"></span>
                        </label>
                        <span style="font-weight: 500;">Dark Mode</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Login Logic ---
        // const CORRECT_PASSCODE = "1234"; // Removed hardcoded passcode
        const registerContainer = document.getElementById('registerContainer');
        const loginContainer = document.getElementById('loginContainer');
        const mainContainer = document.getElementById('mainContainer');
        
        const registerBtn = document.getElementById('registerBtn');
        const regUsername = document.getElementById('regUsername');
        const regPassword = document.getElementById('regPassword');
        const regConfirmPassword = document.getElementById('regConfirmPassword');
        const backToLoginBtn = document.getElementById('backToLoginBtn');
        
        const loginBtn = document.getElementById('loginBtn');
        const loginUsername = document.getElementById('loginUsername');
        const bioBtn = document.getElementById('bioBtn');
        const passInput = document.getElementById('passcode');
        const loginError = document.getElementById('loginError');
        const loginTitle = document.getElementById('loginTitle');
        const forgotBtn = document.getElementById('forgotBtn');
        const goToRegisterBtn = document.getElementById('goToRegisterBtn');
        const rememberMeCheckbox = document.getElementById('rememberMe');
        
        const userAvatar = document.getElementById('userAvatar');
        const profileAvatar = document.getElementById('profileAvatar');
        const topAvatar = document.getElementById('topAvatar');
        const topGreeting = document.getElementById('topGreeting');
        const avatarUpload = document.getElementById('avatarUpload');
        const themePicker = document.getElementById('themePicker');
        const darkModeToggle = document.getElementById('darkModeToggle');

        // Load saved settings
        const savedAvatar = localStorage.getItem('dtr_avatar');
        if (savedAvatar) {
            userAvatar.src = savedAvatar;
            profileAvatar.src = savedAvatar;
            topAvatar.src = savedAvatar;
        }

        const savedTheme = localStorage.getItem('dtr_theme');
        if (savedTheme) {
            document.documentElement.style.setProperty('--primary-color', savedTheme);
            themePicker.value = savedTheme;
        }

        // Load Dark Mode
        if (localStorage.getItem('dtr_dark_mode') === 'true') {
            document.body.classList.add('dark-mode');
            darkModeToggle.checked = true;
        }

        // Check Registration Status
        function checkAuthStatus() {
            const storedPass = localStorage.getItem('dtr_password');
            const storedUser = localStorage.getItem('dtr_username');

            if (!storedPass) {
                // Not registered
                registerContainer.style.display = 'block';
                loginContainer.style.display = 'none';
                mainContainer.style.display = 'none';
                backToLoginBtn.style.display = 'none';
            } else {
                // Registered
                registerContainer.style.display = 'none';
                loginTitle.textContent = `Welcome, ${storedUser || 'User'}`;
                topGreeting.textContent = `Hello, ${storedUser || 'User'}`;
                
                // Check if already logged in
                if (localStorage.getItem('dtr_logged_in') === 'true' || sessionStorage.getItem('dtr_logged_in') === 'true') {
                    loginContainer.style.display = 'none';
                    mainContainer.style.display = 'flex';
                } else {
                    loginContainer.style.display = 'block';
                    mainContainer.style.display = 'none';
                    if (!loginUsername.value) loginUsername.value = storedUser || '';
                }
            }
        }

        // Check login status on load
        checkAuthStatus();

        // Register Function
        registerBtn.addEventListener('click', () => {
            if(regUsername.value && regPassword.value && regConfirmPassword.value) {
                if(regPassword.value !== regConfirmPassword.value) {
                    alert('Passwords do not match!');
                    return;
                }
                localStorage.setItem('dtr_username', regUsername.value);
                localStorage.setItem('dtr_password', regPassword.value);
                alert('Registration Successful! Please login.');
                checkAuthStatus();
            } else {
                alert('Please fill in all fields');
            }
        });

        // Navigation Logic
        goToRegisterBtn.addEventListener('click', () => {
            loginContainer.style.display = 'none';
            registerContainer.style.display = 'block';
            backToLoginBtn.style.display = 'inline-block';
        });

        backToLoginBtn.addEventListener('click', () => {
            registerContainer.style.display = 'none';
            loginContainer.style.display = 'block';
        });

        function attemptLogin() {
            const storedPass = localStorage.getItem('dtr_password');
            const storedUser = localStorage.getItem('dtr_username');
            if (passInput.value === storedPass && loginUsername.value === storedUser) {
                
                if (rememberMeCheckbox.checked) {
                    localStorage.setItem('dtr_logged_in', 'true');
                    localStorage.setItem('dtr_remember_user', loginUsername.value);
                } else {
                    sessionStorage.setItem('dtr_logged_in', 'true');
                    localStorage.removeItem('dtr_remember_user');
                }
                
                loginContainer.style.display = 'none';
                mainContainer.style.display = 'flex';
            } else {
                loginError.style.display = 'block';
            }
        }

        // Forgot Password Logic
        forgotBtn.addEventListener('click', () => {
            if(confirm('Resetting the app will clear your password and require you to register again. Your time records will remain safe. Continue?')) {
                localStorage.removeItem('dtr_password');
                localStorage.removeItem('dtr_logged_in');
                location.reload();
            }
        });

        // --- Biometric Logic ---
        async function attemptBiometric() {
            if (!window.PublicKeyCredential) {
                alert("Biometrics not supported on this browser.");
                return;
            }

            // Helpers for Base64URL encoding/decoding
            const bufferDecode = (val) => Uint8Array.from(atob(val.replace(/-/g, "+").replace(/_/g, "/")), c => c.charCodeAt(0));
            const bufferEncode = (val) => btoa(String.fromCharCode.apply(null, new Uint8Array(val))).replace(/\+/g, "-").replace(/\//g, "_").replace(/=+$/, "");

            const savedId = localStorage.getItem('dtr_bio_id');
            const challenge = new Uint8Array(32);
            window.crypto.getRandomValues(challenge);

            try {
                if (savedId) {
                    // Authenticate existing user
                    await navigator.credentials.get({
                        publicKey: {
                            challenge: challenge,
                            allowCredentials: [{ id: bufferDecode(savedId), type: 'public-key' }],
                            userVerification: 'required'
                        }
                    });
                } else {
                    // Register new user (First time)
                    const cred = await navigator.credentials.create({
                        publicKey: {
                            challenge: challenge,
                            rp: { name: "DTR App" },
                            user: { id: new Uint8Array(16), name: "user", displayName: "User" },
                            pubKeyCredParams: [{alg: -7, type: "public-key"}],
                            authenticatorSelection: { authenticatorAttachment: "platform", userVerification: "required" },
                            timeout: 60000
                        }
                    });
                    localStorage.setItem('dtr_bio_id', bufferEncode(cred.rawId));
                }
                // Success
                
                if (rememberMeCheckbox.checked) {
                    localStorage.setItem('dtr_logged_in', 'true');
                    localStorage.setItem('dtr_remember_user', loginUsername.value);
                } else {
                    sessionStorage.setItem('dtr_logged_in', 'true');
                    localStorage.removeItem('dtr_remember_user');
                }

                loginContainer.style.display = 'none';
                mainContainer.style.display = 'flex';
            } catch (err) {
                console.error(err);
                // Specific error for file:// protocol
                if (window.location.protocol === 'file:') {
                    alert("Security Error: Fingerprint login does not work on local files (file://). Please host this file or use a local server (localhost).");
                } else {
                    alert("Biometric authentication failed or cancelled.");
                }
            }
        }

        loginBtn.addEventListener('click', attemptLogin);
        bioBtn.addEventListener('click', attemptBiometric);
        passInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') attemptLogin(); });

        // Avatar Upload Logic
        const triggerUpload = () => avatarUpload.click();
        userAvatar.addEventListener('click', triggerUpload);
        profileAvatar.addEventListener('click', triggerUpload);
        topAvatar.addEventListener('click', () => showSection('profile'));

        avatarUpload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    userAvatar.src = e.target.result;
                    profileAvatar.src = e.target.result;
                    topAvatar.src = e.target.result;
                    localStorage.setItem('dtr_avatar', e.target.result);
                };
                reader.readAsDataURL(file);
            }
        });

        // Theme Change Logic
        themePicker.addEventListener('input', (e) => {
            const color = e.target.value;
            document.documentElement.style.setProperty('--primary-color', color);
            localStorage.setItem('dtr_theme', color);
        });

        // Dark Mode Logic
        darkModeToggle.addEventListener('change', (e) => {
            if (e.target.checked) {
                document.body.classList.add('dark-mode');
                localStorage.setItem('dtr_dark_mode', 'true');
            } else {
                document.body.classList.remove('dark-mode');
                localStorage.setItem('dtr_dark_mode', 'false');
            }
        });
        
        document.getElementById('logoutBtn').addEventListener('click', () => {
            localStorage.removeItem('dtr_logged_in');
            sessionStorage.removeItem('dtr_logged_in');
            mainContainer.style.display = 'none';
            checkAuthStatus(); // Re-evaluate to show login
            passInput.value = '';
        });

        const dateInput = document.getElementById('date');
        const timeInInput = document.getElementById('timeIn');
        const timeOutInput = document.getElementById('timeOut');
        const addBtn = document.getElementById('addBtn');
        const tableBody = document.querySelector('#dtrTable tbody');
        const searchInput = document.getElementById('searchInput');

        // Initialize date input to today
        dateInput.valueAsDate = new Date();

        // Load records from local storage
        let records = JSON.parse(localStorage.getItem('dtr_records')) || [];

        function renderTable(filterText = '') {
            tableBody.innerHTML = '';
            records.sort((a, b) => new Date(b.date) - new Date(a.date)); // Sort by date descending
            
            const filteredRecords = records.filter(r => r.date.includes(filterText));

            filteredRecords.forEach((record, index) => {
                const row = document.createElement('tr');
                
                // Calculate duration
                const start = new Date(`1970-01-01T${record.timeIn}:00`);
                const end = new Date(`1970-01-01T${record.timeOut}:00`);
                let diff = (end - start) / 1000 / 60 / 60; // Convert ms to hours
                if (diff < 0) diff += 24; // Handle overnight shifts

                row.innerHTML = `
                    <td data-label="Date">${record.date}</td>
                    <td data-label="Time In">${record.timeIn}</td>
                    <td data-label="Time Out">${record.timeOut}</td>
                    <td data-label="Hours">${diff.toFixed(2)}</td>
                    <td data-label="Action"><button class="delete-btn" onclick="deleteRecord(${index})"><i class="fas fa-trash-alt"></i> Delete</button></td>
                `;
                tableBody.appendChild(row);
            });
        }

        function addRecord() {
            if (!dateInput.value || !timeInInput.value || !timeOutInput.value) {
                alert('Please fill in all fields');
                return;
            }
            
            records.push({
                date: dateInput.value,
                timeIn: timeInInput.value,
                timeOut: timeOutInput.value
            });
            
            saveAndRender();
        }

        // Navigation Logic
        window.showSection = function(sectionId) {
            // Update buttons
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            event.currentTarget.classList.add('active');
            
            // Update sections
            document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
            document.getElementById(sectionId + 'Section').classList.add('active');
        }

        window.deleteRecord = function(index) {
            if(confirm('Are you sure you want to delete this record?')) {
                records.splice(index, 1);
                saveAndRender();
            }
        }

        function saveAndRender() {
            localStorage.setItem('dtr_records', JSON.stringify(records));
            renderTable();
        }

        addBtn.addEventListener('click', addRecord);
        searchInput.addEventListener('input', (e) => renderTable(e.target.value));
        
        // Initial render
        renderTable();

        // PWA Manifest Generation (Makes the app installable)
        const manifest = {
            "name": "My Daily Time Record",
            "short_name": "My-DTR",
            "start_url": window.location.href,
            "display": "standalone",
            "background_color": "#ffffff",
            "theme_color": "#007bff",
            "icons": [{
                "src": "https://cdn-icons-png.flaticon.com/512/3135/3135715.png",
                "sizes": "512x512",
                "type": "image/png"
            }]
        };
        const link = document.createElement('link');
        link.rel = 'manifest';
        link.href = URL.createObjectURL(new Blob([JSON.stringify(manifest)], {type: 'application/json'}));
        document.head.appendChild(link);
    </script>
</body>
</html>
